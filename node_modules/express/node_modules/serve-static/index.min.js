/*
 * Connect - static
 * Copyright(c) 2010 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * Copyright(c) 2014 Douglas Christopher Wilson
 * MIT Licensed
 */
var send=require("send");var url=require("url");exports=module.exports=function(a,b){b=b||{};if(!a){throw new TypeError("root path required")}var d=false!==b.redirect;return function c(j,g,i){if("GET"!=j.method&&"HEAD"!=j.method){return i()}var h=url.parse(j.originalUrl);var k=parse(j).pathname;if(k=="/"&&h.pathname[h.pathname.length-1]!="/"){return e()}function e(){if(!d){return i()}var l;h.pathname+="/";l=url.format(h);g.statusCode=303;g.setHeader("Location",l);g.end("Redirecting to "+escape(l))}function f(l){if(404==l.status){return i()}i(l)}send(j,k).maxage(b.maxAge||0).root(a).index(b.index||"index.html").hidden(b.hidden).on("error",f).on("directory",e).pipe(g)}};exports.mime=send.mime;function escape(a){return String(a).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function parse(b){var a=url.parse(b.url);if(a.auth&&!a.protocol&&~a.href.indexOf("//")){a=url.parse(b.url.replace(/@/g,"%40"))}return a};