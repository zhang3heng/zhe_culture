var accepts=require("accepts");var typeis=require("type-is");var http=require("http");var fresh=require("fresh");var parseRange=require("range-parser");var parse=require("parseurl");var req=exports=module.exports={__proto__:http.IncomingMessage.prototype};req.get=req.header=function(a){switch(a=a.toLowerCase()){case"referer":case"referrer":return this.headers.referrer||this.headers.referer;default:return this.headers[a]}};req.accepts=function(){var a=accepts(this);return a.types.apply(a,arguments)};req.acceptsEncoding=req.acceptsEncodings=function(){var a=accepts(this);return a.encodings.apply(a,arguments)};req.acceptsCharset=req.acceptsCharsets=function(){var a=accepts(this);return a.charsets.apply(a,arguments)};req.acceptsLanguage=req.acceptsLanguages=function(){var a=accepts(this);return a.languages.apply(a,arguments)};req.range=function(b){var a=this.get("Range");if(!a){return}return parseRange(b,a)};req.param=function(c,b){var e=this.params||{};var a=this.body||{};var d=this.query||{};if(null!=e[c]&&e.hasOwnProperty(c)){return e[c]}if(null!=a[c]){return a[c]}if(null!=d[c]){return d[c]}return b};req.is=function(a){if(!Array.isArray(a)){a=[].slice.call(arguments)}return typeis(this,a)};req.__defineGetter__("protocol",function(){var b=this.app.get("trust proxy");if(this.connection.encrypted){return"https"}if(!b){return"http"}var a=this.get("X-Forwarded-Proto")||"http";return a.split(/\s*,\s*/)[0]});req.__defineGetter__("secure",function(){return"https"==this.protocol});req.__defineGetter__("ip",function(){return this.ips[0]||this.connection.remoteAddress});req.__defineGetter__("ips",function(){var a=this.app.get("trust proxy");var b=this.get("X-Forwarded-For");return a&&b?b.split(/ *, */):[]});req.__defineGetter__("subdomains",function(){var a=this.app.get("subdomain offset");return(this.host||"").split(".").reverse().slice(a)});req.__defineGetter__("path",function(){return parse(this).pathname});req.__defineGetter__("host",function(){var b=this.app.get("trust proxy");var a=b&&this.get("X-Forwarded-Host");a=a||this.get("Host");if(!a){return}return a.split(":")[0]});req.__defineGetter__("fresh",function(){var b=this.method;var a=this.res.statusCode;if("GET"!=b&&"HEAD"!=b){return false}if((a>=200&&a<300)||304==a){return fresh(this.headers,this.res._headers)}return false});req.__defineGetter__("stale",function(){return !this.fresh});req.__defineGetter__("xhr",function(){var a=this.get("X-Requested-With")||"";return"xmlhttprequest"==a.toLowerCase()});