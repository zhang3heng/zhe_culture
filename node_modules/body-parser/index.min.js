var getBody=require("raw-body");var typeis=require("type-is");var http=require("http");var qs=require("qs");exports=module.exports=bodyParser;exports.json=json;exports.urlencoded=urlencoded;function bodyParser(c){var b=urlencoded(c);var a=json(c);return function d(g,e,f){a(g,e,function(h){if(h){return f(h)}b(g,e,f)})}}function json(c){c=c||{};var b=c.strict!==false;return function a(f,d,e){if(f._body){return e()}f.body=f.body||{};if(!typeis(f,"json")){return e()}f._body=true;getBody(f,{limit:c.limit||"100kb",length:f.headers["content-length"],encoding:"utf8"},function(h,g){if(h){return e(h)}var i=g.trim()[0];if(0==g.length){return e(error(400,"invalid json, empty body"))}if(b&&"{"!=i&&"["!=i){return e(error(400,"invalid json"))}try{f.body=JSON.parse(g,c.reviver)}catch(h){h.body=g;h.status=400;return e(h)}e()})}}function urlencoded(b){b=b||{};return function a(e,c,d){if(e._body){return d()}e.body=e.body||{};if(!typeis(e,"urlencoded")){return d()}e._body=true;getBody(e,{limit:b.limit||"100kb",length:e.headers["content-length"],encoding:"utf8"},function(g,f){if(g){return d(g)}try{e.body=f.length?qs.parse(f):{}}catch(g){g.body=f;return d(g)}d()})}}function error(b,c){var a=new Error(c||http.STATUS_CODES[b]);a.status=b;return a};