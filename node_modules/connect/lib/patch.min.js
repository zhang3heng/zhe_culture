/*
 * Connect
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 */
var http=require("http"),res=http.ServerResponse.prototype,setHeader=res.setHeader,_renderHeaders=res._renderHeaders,writeHead=res.writeHead;if(!res._hasConnectPatch){res.__defineGetter__("headerSent",function(){return this._header});res.setHeader=function(c,d){var a=c.toLowerCase(),b;if(this._headers&&"set-cookie"==a){if(b=this.getHeader(c)){if(Array.isArray(b)){d=b.concat(d)}else{if(Array.isArray(d)){d=d.concat(b)}else{d=[b,d]}}}}else{if("content-type"==a&&this.charset){d+="; charset="+this.charset}}return setHeader.call(this,c,d)};res._renderHeaders=function(){if(!this._emittedHeader){this.emit("header")}this._emittedHeader=true;return _renderHeaders.call(this)};res.writeHead=function(a,b,c){if(typeof b==="object"){c=b}if(typeof c==="object"){Object.keys(c).forEach(function(d){this.setHeader(d,c[d])},this)}if(!this._emittedHeader){this.emit("header")}this._emittedHeader=true;return writeHead.call(this,a,b)};res._hasConnectPatch=true};