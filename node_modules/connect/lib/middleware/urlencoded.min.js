/*
 * Connect - urlencoded
 * Copyright(c) 2010 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 */
var utils=require("../utils");var getBody=require("raw-body");var qs=require("qs");exports=module.exports=function(a){a=a||{};var c=typeof a.verify==="function"&&a.verify;return function b(f,d,e){if(f._body){return e()}f.body=f.body||{};if(!utils.hasBody(f)){return e()}if("application/x-www-form-urlencoded"!=utils.mime(f)){return e()}f._body=true;getBody(f,{limit:a.limit||"1mb",length:f.headers["content-length"],encoding:"utf8"},function(h,g){if(h){return e(h)}if(c){try{c(f,d,g)}catch(h){if(!h.status){h.status=403}return e(h)}}try{f.body=g.length?qs.parse(g):{}}catch(h){h.body=g;return e(h)}e()})}};