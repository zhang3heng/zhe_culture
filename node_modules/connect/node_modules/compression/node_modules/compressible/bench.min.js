var assert=require("assert"),Benchmark=require("benchmark"),suite=new Benchmark.Suite,mime=require("mime"),keys=Object.keys(mime.types),compressible=require("./index.js"),benchmarks=require("beautify-benchmark");function getRandomType(){var a=mime.types[keys[Math.floor(Math.random()*keys.length)]];return a+mime.charsets.lookup(a)}function legacy(b){if(!b||typeof b!=="string"){return false}var a=compressible.specs[b.split(";")];return a?a.compressible:compressible.regex.test(b)}function previous(c){if(!c||typeof c!=="string"){return false}var b=c.indexOf(";"),a=compressible.specs[b<0?c:c.slice(0,b)];return a?a.compressible:compressible.regex.test(c)}describe("Compressible performance benchmarks.",function(){it("Performance of `current` should be within the top 95%",function(){suite.add("current",function(){compressible(getRandomType())}).add("previous",function(){previous(getRandomType())}).add("legacy",function(){legacy(getRandomType())}).on("cycle",function(b){benchmarks.add(b.target)}).on("start",function(b){console.log("\n  Starting...")}).on("complete",function a(){console.log("\n  Done!");var b=benchmarks.getPercent("current");benchmarks.log();if(b<95){assert.fail(""+b+"%","95%`",null,">=",a)}}).run({async:false})})});