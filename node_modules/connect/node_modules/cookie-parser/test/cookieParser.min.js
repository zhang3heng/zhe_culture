var connect=require("connect"),request=require("supertest"),signature=require("cookie-signature");var app=connect();app.use(connect.cookieParser("keyboard cat"));app.use(function(c,a,b){if("/signed"!=c.url){return b()}a.end(JSON.stringify(c.signedCookies))});app.use(function(c,a,b){a.end(JSON.stringify(c.cookies))});describe("connect.cookieParser()",function(){describe("when no cookies are sent",function(){it("should default req.cookies to {}",function(a){request(app).get("/").expect("{}",a)});it("should default req.signedCookies to {}",function(a){request(app).get("/signed").expect("{}",a)})});describe("when cookies are sent",function(){it("should populate req.cookies",function(a){request(app).get("/").set("Cookie","foo=bar; bar=baz").expect('{"foo":"bar","bar":"baz"}',a)})});describe("when a secret is given",function(){var a=signature.sign("foobarbaz","keyboard cat");it("should populate req.signedCookies",function(b){request(app).get("/signed").set("Cookie","foo=s:"+a).expect('{"foo":"foobarbaz"}',b)});it("should remove the signed value from req.cookies",function(b){request(app).get("/").set("Cookie","foo=s:"+a).expect("{}",b)});it("should omit invalid signatures",function(b){request(app).get("/signed").set("Cookie","foo="+a+"3").expect("{}",function(){request(app).get("/").set("Cookie","foo="+a+"3").expect('{"foo":"foobarbaz.CP7AWaXDfAKIRfH49dQzKJx7sKzzSoPq7/AcBBRVwlI3"}',b)})})})});