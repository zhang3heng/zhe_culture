var assert=require("assert"),multiparty=require("../../"),http=require("http"),path=require("path"),TMP_PATH=path.join(__dirname,"..","tmp");var server=http.createServer(function(c,a){var b=new multiparty.Form();b.uploadDir=TMP_PATH;b.on("close",function(){throw new Error('Unexpected "close" event')});b.on("end",function(){throw new Error('Unexpected "end" event')});b.on("error",function(d){a.writeHead(500);a.end(d.message)});b.parse(c)});server.listen(0,function(){var a='--foo\r\nContent-Disposition: form-data; name="file1"; filename="file1"\r\nContent-Type: application/octet-stream\r\n\r\nThis is the first file\r\n--foo\r\nContent-Type: application/octet-stream\r\nContent-Disposition: form-data; name="file2"; filename="file2"\r\nContent-Transfer-Encoding: unknown\r\n\r\nThis is the second file\r\n--foo--\r\n';var b=http.request({method:"POST",port:server.address().port,headers:{"Content-Length":a.length,"Content-Type":"multipart/form-data; boundary=foo"}});b.on("response",function(c){assert.equal(c.statusCode,500);c.on("data",function(){});c.on("end",function(){server.close()})});b.end(a)});