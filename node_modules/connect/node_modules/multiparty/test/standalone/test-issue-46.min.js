var http=require("http"),multiparty=require("../../"),request=require("request"),assert=require("assert");var host="localhost";var index=['<form action="/" method="post" enctype="multipart/form-data">','  <input type="text" name="foo" />','  <input type="submit" />',"</form>"].join("\n");var server=http.createServer(function(c,a){if(c.method==="GET"){a.writeHead(200,{"content-type":"text/html"});a.end(index);return}var b=new multiparty.Form();b.parse(c,function(f,d,e){a.writeHead(200,{"content-type":"text/plain"});a.write(JSON.stringify({err:f,fields:d,files:e}));a.end()})}).listen(0,host,function(){var d=this,a="http://"+host+":"+d.address().port;var c=[{"Content-Disposition":'form-data; name="foo"',body:"bar"}];var b=request({method:"POST",url:a,multipart:c},function(i,g,f){var h=JSON.parse(f);assert.equal("bar",h.fields.foo);d.close()})});