var assert=require("assert");var http=require("http");var net=require("net");var multiparty=require("../../");var client;var attachmentCount=510;var server=http.createServer(function(c,a){var b=new multiparty.Form({maxFields:10000});b.parse(c,function(g,e,d,f,h){assert.strictEqual(g.code,"EMFILE");a.end();client.end();server.close()})});server.listen(function(){client=net.connect(server.address().port);var d="------WebKitFormBoundaryvfUZhxgsZDO7FXLF\r\n";var c=d+'Content-Disposition: form-data; name="upload"; filename="blah1.txt"\r\nContent-Type: text/plain\r\n\r\nhi1\r\n\r\n';var b=c.length*attachmentCount+d.length;client.write("POST /upload HTTP/1.1\r\nContent-Length: "+b+"\r\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryvfUZhxgsZDO7FXLF\r\n\r\n");for(var a=0;a<attachmentCount;a+=1){client.write(c)}client.write(d)});