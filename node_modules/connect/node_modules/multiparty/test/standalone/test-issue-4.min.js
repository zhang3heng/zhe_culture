var http=require("http"),multiparty=require("../../"),assert=require("assert"),superagent=require("superagent"),path=require("path");var server=http.createServer(function(c,a){assert.strictEqual(c.url,"/upload");assert.strictEqual(c.method,"POST");var b=new multiparty.Form({autoFields:true,autoFiles:true});b.on("error",function(e){console.log(e)});b.on("close",function(){});var d=0;b.on("file",function(e,f){d+=1});b.parse(c,function(i,f,h){var e=0;for(var g in h){e+=1}assert.strictEqual(d,2);assert.strictEqual(e,1);a.end()})});server.listen(function(){var a="http://localhost:"+server.address().port+"/upload";var b=superagent.post(a);b.attach("files[]",fixture("pf1y5.png"),"SOG2.JPG");b.attach("files[]",fixture("binaryfile.tar.gz"),"BenF364_LIB353.zip");b.end(function(c,d){assert.ifError(c);d.on("end",function(){server.close()})})});function fixture(a){return path.join(__dirname,"..","fixture","file",a)};